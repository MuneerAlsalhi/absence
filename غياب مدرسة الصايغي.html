<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</title>

<style>
*{box-sizing:border-box;font-family:"Segoe UI",Tahoma,Arial}
body{
    margin:0;
    direction:rtl;
    background:#f1f5f9;
}

/* Ø¹Ø§Ù… */
.hidden{display:none}
h1,h2{text-align:center}
button{
    padding:12px;
    border:none;
    border-radius:10px;
    font-size:16px;
}
input,select,textarea{
    width:100%;
    padding:12px;
    margin:6px 0;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:15px;
}
.box{
    background:#fff;
    margin:10px;
    padding:15px;
    border-radius:14px;
    box-shadow:0 4px 10px rgba(0,0,0,.08);
}

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.login{
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(135deg,#6366f1,#3b82f6);
}
.login-card{
    background:#fff;
    width:90%;
    max-width:380px;
    padding:25px;
    border-radius:24px;
    text-align:center;
}
.logo{
    font-size:40px;
    margin-bottom:10px;
}
.login-card button{
    background:#4f46e5;
    color:#fff;
    font-weight:600;
}

/* Ø£Ø²Ø±Ø§Ø± */
.logout{background:#ef4444;color:#fff;margin:10px}
.add{background:#22c55e;color:#fff}
.edit{background:#0ea5e9;color:#fff}
.del{background:#dc2626;color:#fff}

/* Ø¬Ø¯ÙˆÙ„ */
table{width:100%;border-collapse:collapse}
th,td{padding:8px;text-align:center}
th{background:#4f46e5;color:#fff}
td{background:#f8fafc}

/* Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media(max-width:768px){
    table,thead,tbody,tr,td{display:block}
    thead{display:none}
    tr{margin-bottom:10px}
    td{display:flex;justify-content:space-between}
    td::before{content:attr(data-label);font-weight:600}
}
</style>
</head>
<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginBox" class="login">
<div class="login-card">
    <div class="logo">ğŸ«</div>
    <h2>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´ÙŠØ® Ø³Ø§Ù„Ù… Ø§Ù„ØµØ§Ø¦ØºÙŠ</h2>
    <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ -->
<div id="adminPanel" class="hidden">
<h1>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h1>
<button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

<div class="box">
<h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙˆÙ</h2>
<textarea id="newClass" rows="3" placeholder="ÙƒÙ„ ØµÙ ÙÙŠ Ø³Ø·Ø±"></textarea>
<button class="add" onclick="addClass()">Ø¥Ø¶Ø§ÙØ© ØµÙÙˆÙ</button>
<select id="classList"></select>
<input id="editClassName" placeholder="Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯">
<button class="edit" onclick="editClass()">ØªØ¹Ø¯ÙŠÙ„</button>
<button class="del" onclick="deleteClass()">Ø­Ø°Ù</button>
</div>

<div class="box">
<h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
<select id="studentClass" onchange="loadAdminStudents()"></select>
<textarea id="studentName" rows="3" placeholder="ÙƒÙ„ Ø·Ø§Ù„Ø¨ ÙÙŠ Ø³Ø·Ø±"></textarea>
<button class="add" onclick="addStudent()">Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨</button>
<select id="studentList"></select>
<input id="editStudentName" placeholder="Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯">
<button class="edit" onclick="editStudent()">ØªØ¹Ø¯ÙŠÙ„</button>
<button class="del" onclick="deleteStudent()">Ø­Ø°Ù</button>
</div>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… -->
<div id="teacherPanel" class="hidden">
<h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºÙŠØ§Ø¨</h1>
<button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

<div class="box">
<select id="attendanceClass" onchange="loadAttendanceStudents()"></select>
<select id="attendanceStudent"></select>
<input type="date" id="date">

<select id="period">
<option>Ø§Ù„Ø­ØµØ© 1</option><option>Ø§Ù„Ø­ØµØ© 2</option><option>Ø§Ù„Ø­ØµØ© 3</option>
<option>Ø§Ù„Ø­ØµØ© 4</option><option>Ø§Ù„Ø­ØµØ© 5</option><option>Ø§Ù„Ø­ØµØ© 6</option>
<option>Ø§Ù„Ø­ØµØ© 7</option>
</select>

<select id="status">
<option>Ø­Ø§Ø¶Ø±</option>
<option>ØºØ§Ø¦Ø¨</option>
</select>

<button class="add" onclick="addAttendance()">ØªØ³Ø¬ÙŠÙ„</button>
</div>

<div class="box">
<table>
<thead>
<tr><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­ØµØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr>
</thead>
<tbody id="attTable"></tbody>
</table>
</div>

<div class="box">
<h2>ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</h2>
<select id="reportClass"></select>
<input type="month" id="reportMonth">
<button onclick="generateReport()">Ø¹Ø±Ø¶</button>

<table>
<thead>
<tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨</th><th>ØªÙ†Ø¨ÙŠÙ‡</th></tr>
</thead>
<tbody id="reportBody"></tbody>
</table>
</div>
</div>

<script>
const ADMIN_USER="admin", ADMIN_PASS="1234";
let classes=JSON.parse(localStorage.getItem("classes"))||{};
let attendance=JSON.parse(localStorage.getItem("attendance"))||[];

function save(){
 localStorage.setItem("classes",JSON.stringify(classes));
 localStorage.setItem("attendance",JSON.stringify(attendance));
}

function login(){
 loginBox.classList.add("hidden");
 if(username.value===ADMIN_USER && password.value===ADMIN_PASS){
   adminPanel.classList.remove("hidden");
   refreshAdmin();
 }else{
   teacherPanel.classList.remove("hidden");
   refreshTeacher();
 }
}

function logout(){
 adminPanel.classList.add("hidden");
 teacherPanel.classList.add("hidden");
 loginBox.classList.remove("hidden");
}

function refreshAdmin(){
 classList.innerHTML=""; studentClass.innerHTML="";
 Object.keys(classes).forEach(c=>{
   classList.innerHTML+=`<option>${c}</option>`;
   studentClass.innerHTML+=`<option>${c}</option>`;
 });
 loadAdminStudents();
}

function addClass(){
 newClass.value.split("\n").map(v=>v.trim()).filter(v=>v)
 .forEach(c=>{if(!classes[c])classes[c]=[]});
 save(); refreshAdmin(); newClass.value="";
}

function editClass(){
 classes[editClassName.value]=classes[classList.value];
 delete classes[classList.value];
 save(); refreshAdmin();
}

function deleteClass(){
 delete classes[classList.value];
 save(); refreshAdmin();
}

function loadAdminStudents(){
 studentList.innerHTML="";
 (classes[studentClass.value]||[]).forEach(s=>{
  studentList.innerHTML+=`<option>${s}</option>`;
 });
}

function addStudent(){
 classes[studentClass.value].push(...studentName.value.split("\n").map(v=>v.trim()).filter(v=>v));
 save(); refreshAdmin(); studentName.value="";
}

function editStudent(){
 let c=studentClass.value;
 let i=classes[c].indexOf(studentList.value);
 classes[c][i]=editStudentName.value;
 save(); refreshAdmin();
}

function deleteStudent(){
 let c=studentClass.value;
 classes[c]=classes[c].filter(s=>s!==studentList.value);
 save(); refreshAdmin();
}

function refreshTeacher(){
 attendanceClass.innerHTML=""; reportClass.innerHTML="";
 Object.keys(classes).forEach(c=>{
  attendanceClass.innerHTML+=`<option>${c}</option>`;
  reportClass.innerHTML+=`<option>${c}</option>`;
 });
 loadAttendanceStudents();
}

function loadAttendanceStudents(){
 attendanceStudent.innerHTML="";
 (classes[attendanceClass.value]||[]).forEach(s=>{
  attendanceStudent.innerHTML+=`<option>${s}</option>`;
 });
}

function addAttendance(){
 attendance.push({
  class:attendanceClass.value,
  student:attendanceStudent.value,
  date:date.value,
  period:period.value,
  status:status.value
 });
 save(); renderAttendance();
}

function renderAttendance(){
 attTable.innerHTML="";
 attendance.forEach(r=>{
  attTable.innerHTML+=`
   <tr>
    <td data-label="Ø§Ù„ØµÙ">${r.class}</td>
    <td data-label="Ø§Ù„Ø·Ø§Ù„Ø¨">${r.student}</td>
    <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${r.date}</td>
    <td data-label="Ø§Ù„Ø­ØµØ©">${r.period}</td>
    <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">${r.status}</td>
   </tr>`;
 });
}

function generateReport(){
 let cls=reportClass.value, m=reportMonth.value;
 let count={};
 attendance.forEach(r=>{
  if(r.class===cls && r.status==="ØºØ§Ø¦Ø¨" && r.date.startsWith(m)){
   count[r.student]=(count[r.student]||new Set()).add(r.date);
  }
 });
 reportBody.innerHTML="";
 Object.keys(count).forEach(s=>{
  let days=count[s].size;
  reportBody.innerHTML+=`
   <tr style="color:${days>=5?'red':'green'}">
    <td>${s}</td>
    <td>${days}</td>
    <td>${days>=5?'âš ':'âœ”'}</td>
   </tr>`;
 });
}
</script>

</body>
</html>
